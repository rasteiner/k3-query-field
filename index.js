!function(){"use strict";let t,e,n={};const r=[[-1,1,t=>{e=t}],[0,1,t=>{e=t}],[1,1,t=>{e=t}],[1,4,(t,n,r,s)=>{e=["subscript",[t,r]]}],[2,1,t=>{e=t}],[2,3,(t,n,r)=>{e=["method",[t,[]]]}],[2,4,(t,n,r,s)=>{e=["method",[t,r]]}],[3,1,t=>{e=t}],[3,3,(t,n,r)=>{e=["access",[t,r]]}],[4,3,(t,n,r)=>{e=n}],[4,1,t=>{e=t}],[4,1,t=>{e=t}],[5,1,t=>{e=["id",t]}],[6,1,t=>{e=["val",t,"'"]}],[6,1,t=>{e=["val",t,'"']}],[6,1,t=>{e=["val",parseInt(t)]}],[6,1,t=>{e=["val",parseFloat(t)]}],[6,1,t=>{e=["val",!0]}],[6,1,t=>{e=["val",!1]}],[6,1,t=>{e=["val",null]}],[6,3,(t,n,r)=>{e=["val",n]}],[6,2,(t,n)=>{e=["val",[]]}],[7,1,t=>{e=[t]}],[7,3,(t,n,r)=>{t.push(r),e=t}]],s={LBRACKET:"8",RBRACKET:"9",LPAREN:"10",RPAREN:"11",DOT:"12",IDENTIFIER:"13",STRING1:"14",STRING2:"15",INT:"16",FLOAT:"17",TRUE:"18",FALSE:"19",NULL:"20",COMMA:"21",$:"22"},i=[{0:1,1:2,2:3,3:4,4:5,5:8,6:7,8:"s16",10:"s6",13:"s17",14:"s9",15:"s10",16:"s11",17:"s12",18:"s13",19:"s14",20:"s15"},{22:"acc"},{8:"s18",9:"r1",11:"r1",12:"s19",21:"r1",22:"r1"},{8:"r2",9:"r2",10:"s22",11:"r2",12:"r2",21:"r2",22:"r2"},{8:"r4",9:"r4",10:"r4",11:"r4",12:"r4",21:"r4",22:"r4"},{8:"r7",9:"r7",10:"r7",11:"r7",12:"r7",21:"r7",22:"r7"},{0:29,1:2,2:3,3:4,4:5,5:8,6:7,8:"s16",10:"s6",13:"s17",14:"s9",15:"s10",16:"s11",17:"s12",18:"s13",19:"s14",20:"s15"},{8:"r10",9:"r10",10:"r10",11:"r10",12:"r10",21:"r10",22:"r10"},{8:"r11",9:"r11",10:"r11",11:"r11",12:"r11",21:"r11",22:"r11"},{8:"r13",9:"r13",10:"r13",11:"r13",12:"r13",21:"r13",22:"r13"},{8:"r14",9:"r14",10:"r14",11:"r14",12:"r14",21:"r14",22:"r14"},{8:"r15",9:"r15",10:"r15",11:"r15",12:"r15",21:"r15",22:"r15"},{8:"r16",9:"r16",10:"r16",11:"r16",12:"r16",21:"r16",22:"r16"},{8:"r17",9:"r17",10:"r17",11:"r17",12:"r17",21:"r17",22:"r17"},{8:"r18",9:"r18",10:"r18",11:"r18",12:"r18",21:"r18",22:"r18"},{8:"r19",9:"r19",10:"r19",11:"r19",12:"r19",21:"r19",22:"r19"},{0:25,1:2,2:3,3:4,4:5,5:8,6:7,7:31,8:"s16",9:"s32",10:"s6",13:"s17",14:"s9",15:"s10",16:"s11",17:"s12",18:"s13",19:"s14",20:"s15"},{8:"r12",9:"r12",10:"r12",11:"r12",12:"r12",21:"r12",22:"r12"},{0:20,1:2,2:3,3:4,4:5,5:8,6:7,8:"s16",10:"s6",13:"s17",14:"s9",15:"s10",16:"s11",17:"s12",18:"s13",19:"s14",20:"s15"},{5:34,13:"s17"},{9:"s21"},{8:"r3",9:"r3",11:"r3",12:"r3",21:"r3",22:"r3"},{0:25,1:2,2:3,3:4,4:5,5:8,6:7,7:24,8:"s16",10:"s6",11:"s23",13:"s17",14:"s9",15:"s10",16:"s11",17:"s12",18:"s13",19:"s14",20:"s15"},{8:"r5",9:"r5",10:"r5",11:"r5",12:"r5",21:"r5",22:"r5"},{11:"s26",21:"s27"},{9:"r22",11:"r22",21:"r22"},{8:"r6",9:"r6",10:"r6",11:"r6",12:"r6",21:"r6",22:"r6"},{0:28,1:2,2:3,3:4,4:5,5:8,6:7,8:"s16",10:"s6",13:"s17",14:"s9",15:"s10",16:"s11",17:"s12",18:"s13",19:"s14",20:"s15"},{9:"r23",11:"r23",21:"r23"},{11:"s30"},{8:"r9",9:"r9",10:"r9",11:"r9",12:"r9",21:"r9",22:"r9"},{9:"s33",21:"s27"},{8:"r21",9:"r21",10:"r21",11:"r21",12:"r21",21:"r21",22:"r21"},{8:"r20",9:"r20",10:"r20",11:"r20",12:"r20",21:"r20",22:"r20"},{8:"r8",9:"r8",10:"r8",11:"r8",12:"r8",21:"r8",22:"r8"}],o=[];let l;const a=[[/^\s+/,function(){}],[/^\btrue\b/,function(){return"TRUE"}],[/^\bfalse\b/,function(){return"FALSE"}],[/^\bnull\b/,function(){return"NULL"}],[/^\(/,function(){return"LPAREN"}],[/^\)/,function(){return"RPAREN"}],[/^\[/,function(){return"LBRACKET"}],[/^\]/,function(){return"RBRACKET"}],[/^,/,function(){return"COMMA"}],[/^\d*\.\d+/,function(){return"FLOAT"}],[/^\d+/,function(){return"INT"}],[/^\./,function(){return"DOT"}],[/^[a-zA-Z0-9_]+/,function(){return"IDENTIFIER"}],[/^"(?:\\[\"\\]|[^\"\\])*"/,function(){return t=t.slice(1,-1),"STRING2"}],[/^'(?:\\[\'\\]|[^\'\\])*'/,function(){return t=t.slice(1,-1),"STRING1"}]],u={INITIAL:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]},c={type:"$",value:""};l={initString(t){return this._string=t,this._cursor=0,this._states=["INITIAL"],this._tokensQueue=[],this._currentLine=1,this._currentColumn=0,this._currentLineBeginOffset=0,this._tokenStartOffset=0,this._tokenEndOffset=0,this._tokenStartLine=1,this._tokenEndLine=1,this._tokenStartColumn=0,this._tokenEndColumn=0,this},getStates(){return this._states},getCurrentState(){return this._states[this._states.length-1]},pushState(t){this._states.push(t)},begin(t){this.pushState(t)},popState(){return this._states.length>1?this._states.pop():this._states[0]},getNextToken(){if(this._tokensQueue.length>0)return this.onToken(this._toToken(this._tokensQueue.shift()));if(!this.hasMoreTokens())return this.onToken(c);let e=this._string.slice(this._cursor),n=u[this.getCurrentState()];for(let r=0;r<n.length;r++){let s=n[r],i=a[s],o=this._match(e,i[0]);if(""===e&&""===o&&this._cursor++,null!==o){t=o;let e=i[1].call(this);if(!e)return this.getNextToken();if(Array.isArray(e)){const t=e.slice(1);e=e[0],t.length>0&&this._tokensQueue.unshift(...t)}return this.onToken(this._toToken(e,t))}}if(this.isEOF())return this._cursor++,c;this.throwUnexpectedToken(e[0],this._currentLine,this._currentColumn)},throwUnexpectedToken(t,e,n){const r=this._string.split("\n")[e-1];let s="";if(r){s="\n\n"+r+"\n"+" ".repeat(n)+"^\n"}throw new SyntaxError(`${s}Unexpected token: "${t}" at ${e}:${n}.`)},getCursor(){return this._cursor},getCurrentLine(){return this._currentLine},getCurrentColumn(){return this._currentColumn},_captureLocation(t){const e=/\n/g;let n;for(this._tokenStartOffset=this._cursor,this._tokenStartLine=this._currentLine,this._tokenStartColumn=this._tokenStartOffset-this._currentLineBeginOffset;null!==(n=e.exec(t));)this._currentLine++,this._currentLineBeginOffset=this._tokenStartOffset+n.index+1;this._tokenEndOffset=this._cursor+t.length,this._tokenEndLine=this._currentLine,this._tokenEndColumn=this._currentColumn=this._tokenEndOffset-this._currentLineBeginOffset},_toToken(t,e=""){return{type:t,value:e,startOffset:this._tokenStartOffset,endOffset:this._tokenEndOffset,startLine:this._tokenStartLine,endLine:this._tokenEndLine,startColumn:this._tokenStartColumn,endColumn:this._tokenEndColumn}},isEOF(){return this._cursor===this._string.length},hasMoreTokens(){return this._cursor<=this._string.length},_match(t,e){let n=t.match(e);return n?(this._captureLocation(n[0]),this._cursor+=n[0].length,n[0]):null},onToken:t=>t},n.lexer=l,n.tokenizer=l,n.options={captureLocations:!1};const h={setOptions(t){return n.options=t,this},getOptions:()=>n.options,parse(a,u){if(!l)throw new Error("Tokenizer instance wasn't specified.");l.initString(a);let c=n.options;u&&(n.options=Object.assign({},n.options,u)),h.onParseBegin(a,l,n.options),o.length=0,o.push(0);let d=l.getNextToken(),_=null;do{d||(n.options=c,p());let a=o[o.length-1],u=s[d.type];i[a].hasOwnProperty(u)||(n.options=c,f(d));let g=i[a][u];if("s"===g[0]){let t=null;n.options.captureLocations&&(t={startOffset:d.startOffset,endOffset:d.endOffset,startLine:d.startLine,endLine:d.endLine,startColumn:d.startColumn,endColumn:d.endColumn}),_=this.onShift(d),o.push({symbol:s[_.type],semanticValue:_.value,loc:t},Number(g.slice(1))),d=l.getNextToken()}else if("r"===g[0]){let s=g.slice(1),l=r[s],a="function"==typeof l[2],u=a?[]:null;const c=a&&n.options.captureLocations?[]:null;if(0!==l[1]){let t=l[1];for(;t-- >0;){o.pop();let t=o.pop();a&&(u.unshift(t.semanticValue),c&&c.unshift(t.loc))}}const h={symbol:l[0]};if(a){t=_?_.value:null,_&&_.value.length;const n=null!==c?u.concat(c):u;l[2](...n),h.semanticValue=e,c&&(h.loc=undefined)}const f=o[o.length-1],p=l[0];o.push(h,i[f][p])}else if("acc"===g){o.pop();let t=o.pop();return(1!==o.length||0!==o[0]||l.hasMoreTokens())&&(n.options=c,f(d)),t.hasOwnProperty("semanticValue")?(n.options=c,h.onParseEnd(t.semanticValue),t.semanticValue):(h.onParseEnd(),n.options=c,!0)}}while(l.hasMoreTokens()||o.length>1)},setTokenizer:t=>(l=t,h),getTokenizer:()=>l,onParseBegin(t,e,n){},onParseEnd(t){},onShift:t=>t};function f(t){"$"===t.type&&p(),l.throwUnexpectedToken(t.value,t.startLine,t.startColumn)}function p(){!function(t){throw new SyntaxError(t)}("Unexpected end of input.")}module.exports=h;function d(t,e,n,r,s,i,o,l){var a,u="function"==typeof t?t.options:t;if(e&&(u.render=e,u.staticRenderFns=n,u._compiled=!0),r&&(u.functional=!0),i&&(u._scopeId="data-v-"+i),o?(a=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),s&&s.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(o)},u._ssrRegister=a):s&&(a=l?function(){s.call(this,(u.functional?this.parent:this).$root.$options.shadowRoot)}:s),a)if(u.functional){u._injectStyles=a;var c=u.render;u.render=function(t,e){return a.call(e),c(t,e)}}else{var h=u.beforeCreate;u.beforeCreate=h?[].concat(h,a):[a]}return{exports:t,options:u}}function _(){const t=document.createElement("div");return t.setAttribute("contenteditable","PLAINTEXT-ONLY"),"plaintext-only"===t.contentEditable}function g(t){switch(t[0]){case"id":return t[1];case"val":switch(typeof t[1]){case"string":return`${t[2]}${t[1]}${t[2]}`;case"number":return t[1];case"boolean":return t[1]?"true":"false";case"object":return null===t[1]?"null":`[${t[1].map(g).join(", ")}]`}case"access":return t[1].map(g).join(".");case"method":return t[1][1].length?`${g(t[1][0])}(${t[1][1].map(g).join(", ")})`:g(t[1][0]);case"subscript":return`${g(t[1][0])}[${g(t[1][1])}]`}return""}function T(t){return t.map((t=>t.replace(/^\s{1,2}/g,"")))}const m={};var C=d({data:()=>({error:null,styledHtml:null,observer:null,plaintextOnlySupport:_()}),props:{value:{default:{literal:"",clean:""},type:Object}},watch:{value(t){t&&t.literal&&(this.parse(t.literal||""),this.$refs.editor.innerText!==t.literal&&this.setText(t.literal))}},mounted(){const t=new ResizeObserver((([t])=>{if(this.$refs.container){const e=t.borderBoxSize[0].blockSize;this.$refs.container.style.height=`${e}px`}}));t.observe(this.$refs.editor),this.observer=t,this.value&&(this.setText(this.value.literal||""),this.parse(this.value.literal))},beforeDestroy(){this.observer.disconnect()},computed:{query(){return this.ast?g(this.ast):""}},methods:{select(t,e){const n=document.createRange();n.setStart(this.$refs.editor.firstChild,t),n.setEnd(this.$refs.editor.firstChild,e||t);const r=window.getSelection();r.removeAllRanges(),r.addRange(n)},setText(t,e,n){this.$refs.editor.innerHTML="",this.$refs.editor.appendChild(document.createTextNode(t)),e&&this.select(e,n)},tabPress(t){const e=window.getSelection().getRangeAt(0),n=Array.from(this.$refs.editor.childNodes).filter((t=>t.nodeType===Node.TEXT_NODE)),r=this.$refs.editor.textContent.split("\n"),s=e.startContainer.nodeType===Node.TEXT_NODE?n.slice(0,n.indexOf(e.startContainer)):[],i=e.startContainer.textContent.substr(0,e.startOffset),o=s.map((t=>t.textContent)).join("")+i,l=e.toString(),a=o.split("\n").length-1;let u=(o+l).split("\n").length;const c=r.slice(a,u);let h=o.split("\n").slice(-1)[0].length,f=(o+l).split("\n").slice(-1)[0].length;if(0===f&&c.length>1&&(c.pop(),f=c[c.length-1].length,u-=1),1===c.length&&c[0].length>l.length||0===c[0].length)if(t.shiftKey){const t=T(c)[0],e=t.length-r[a].length;r[a]=t,h+=e,f+=e}else r[a]=r[a].substr(0,h)+"  "+r[a].substr(f),h+=2,f=h;else{const e=t.shiftKey?T(c):function(t){return t.map((t=>"  "+t))}(c),n=e[0].length-c[0].length,s=e[e.length-1].length-c[c.length-1].length;r.splice(a,e.length,...e),1===c.length?h=0:(h+=n,h=Math.max(h,0)),f+=s}const p=r.slice(0,a).join("\n").length+1+h,d=r.slice(0,u-1).join("\n").length+1+f,_=r.join("\n");this.setText(_,p,d),this.onInput(_)},enterPress(t){const e=window.getSelection().getRangeAt(0),n=Array.from(this.$refs.editor.childNodes).filter((t=>t.nodeType===Node.TEXT_NODE)),r=e.startContainer.nodeType===Node.TEXT_NODE?n.slice(0,n.indexOf(e.startContainer)):[],s=e.startContainer.textContent.substr(0,e.startOffset),i=e.endContainer.nodeType===Node.TEXT_NODE?n.slice(n.indexOf(e.endContainer)+1):[],o=e.endContainer.textContent.substr(e.endOffset),l=r.map((t=>t.textContent)).join("")+s,a=o+i.map((t=>t.textContent)).join(""),u=l.split("\n").pop().match(/^\s*/)[0].length,c="\n"+new Array(u+1).join(" "),h=l+c+(a.endsWith("\n")?a:a+"\n");console.log(c.length),this.setText(h,l.length+c.length),this.onInput(h)},focus(){this.select(this.$refs.editor.firstChild.length)},parse(t){const e=document.createDocumentFragment();if(this.$refs.styled.innerHTML="",!t.trim())return this.error=null,{literal:"",clean:""};{let r=0;try{const n=(void 0)(t,{captureLocations:!0});return this.error=null,this.$refs.styled.appendChild(e),{literal:t,clean:g(n)}}catch(n){return this.ast=null,e.appendChild(document.createTextNode(t.slice(r))),this.$refs.styled.appendChild(e),this.error=n,{literal:t,clean:""}}}},onInput(t){this.$nextTick((()=>{this.$emit("input",this.parse(t))}))}}},(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("k-field",t._b({staticClass:"query-field"},"k-field",t.$attrs,!1),[n("div",{ref:"container",staticClass:"container"},[n("pre",{ref:"editor",staticClass:"editor",attrs:{spellcheck:"false",contenteditable:t.plaintextOnlySupport?"plaintext-only":"true"},on:{input:function(e){return t.onInput(e.target.innerText)},keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"tab",9,e.key,"Tab")?null:(e.preventDefault(),t.tabPress.apply(null,arguments))},keypress:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:(e.preventDefault(),t.enterPress.apply(null,arguments))}}}),n("pre",{ref:"styled",staticClass:"styled"})]),t.error&&t.value?n("pre",{staticClass:"error",domProps:{innerHTML:t._s(t.error)}}):t._e()])}),[],!1,k,null,null,null);function k(t){for(let e in m)this[e]=m[e]}var y=function(){return C.exports}();const E={};var O=d({props:{value:String,column:Object,field:Object}},(function(){var t=this,e=t.$createElement;return(t._self._c||e)("pre",{staticClass:"k-structure-table-text"},[t._v(t._s(t.value.clean))])}),[],!1,v,null,null,null);function v(t){for(let e in E)this[e]=E[e]}var x=function(){return O.exports}();window.panel.plugin("rasteiner/k3-query-field",{fields:{query:y},components:{"k-query-field-preview":x}})}();
